---
title: ''
output:
  html_document:
    css:
    - style.css
    - https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css
  pdf_document: default
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r DATAIMPORT, echo = FALSE, message = FALSE, warning= FALSE}
rm(list = ls())
library(tidyverse)
library(leaflet)
library(dplyr)
library(readr)
library(jsonlite)
library(rvest)
library(magrittr)

# Data on Drug accidents in the US 2015-2018
drug_set <- read_csv("https://data.cdc.gov/api/views/xkb8-kh2a/rows.csv?accessType=DOWNLOAD")

# Adding states names to dataset

drug_set <- drug_set %>% mutate(state = case_when(State == "AK" ~ "Alaska",
                                                  State == "AL" ~ "Alabama",
                                                  State == "AZ" ~ "Arizona",
                                                  State == "AR" ~ "Arkansas",
                                                  State == "CA" ~ "California",
                                                  State == "CO" ~ "Colorado",
                                                  State == "CT" ~ "Connecticut",
                                                  State == "DC" ~ "District of Columbia",
                                                  State == "DE" ~ "Delaware",
                                                  State == "FL" ~ "Florida",
                                                  State == "GA" ~ "Georgia",
                                                  State == "HI" ~ "Hawaii",
                                                  State == "ID" ~ "Idaho",
                                                  State == "IL" ~ "Illinois",
                                                  State == "IN" ~ "Indiana",
                                                  State == "IA" ~ "Iowa",
                                                  State == "KS" ~ "Kansas",
                                                  State == "KY" ~ "Kentucky",
                                                  State == "LA" ~ "Louisiana",
                                                  State == "ME" ~ "Maine",
                                                  State == "MD" ~ "Maryland",
                                                  State == "MA" ~ "Massachusetts",
                                                  State == "MI" ~ "Michigan",
                                                  State == "MN" ~ "Minnesota",
                                                  State == "MS" ~ "Mississippi",
                                                  State == "MO" ~ "Missouri",
                                                  State == "MT" ~ "Montana",
                                                  State == "NE" ~ "Nebraska",
                                                  State == "NV" ~ "Nevada",
                                                  State == "NH" ~ "New Hampshire",
                                                  State == "NJ" ~ "New Jersey",
                                                  State == "NM" ~ "New Mexico",
                                                  State == "NY" ~ "New York",
                                                  State == "NC" ~ "North Carolina",
                                                  State == "ND" ~ "North Dakota",
                                                  State == "OH" ~ "Ohio",
                                                  State == "OK" ~ "Oklahoma",
                                                  State == "OR" ~ "Oregon",
                                                  State == "PA" ~ "Pennsylvania",
                                                  State == "RI" ~ "Rhode Island",
                                                  State == "SC" ~ "South Carolina",
                                                  State == "SD" ~ "South Dakota",
                                                  State == "TN" ~ "Tennessee",
                                                  State == "TX" ~ "Texas",
                                                  State == "US" ~ "United States of America federal state",
                                                  State == "UT" ~ "Utah",
                                                  State == "VT" ~ "Vermont",
                                                  State == "VA" ~ "Virginia", 
                                                  State == "WA" ~ "Washington",
                                                  State == "WV" ~ "West Virginia",
                                                  State == "WI" ~ "Wisconsin",
                                                  State == "WY" ~ "Wyoming",
                                                  State == "YC" ~ "Yucatan(MEX)"))
# Changing colnames 
colnames(drug_set) <- c("State","State_abbreviations","Year", "Month", "Indicator", "Deaths", "Predicted_Value", "Percent_complete", "Percent_pending_investigation","Footnote","State_name")

# Removing the first colum we have two of                                                                       
drug_set$State <- NULL

# Rearranging colums 
drug_set <- drug_set[,c(10,1,2,3,4,5,6,7,8,9)]


# Taking a look at the dataset after cleaning. 
head(drug_set)

# Examining the footnote colum
unique(drug_set$Footnote)
unique(drug_set$Year)

# If the code below is runned the data for 2017 and 2018 are removed. This is because the investigation on cases not are 
# juridicaly finished and solved and some cases are underreported due to incomplete data. We still want to use the data for 2017 and 2018.

# drug_set <- drug_set %>%
  # filter(is.na(Footnote))







```

```{r dataimport_income}
# Data on medianincome from api
getdata <- fromJSON("https://api.datausa.io/api/?sort=desc&show=geo&required=income&sumlevel=state&year=all&where=geo%3A%5E04000US")

#Getting data out of list
income <- getdata[["data"]]

#Labeling data 
colnames(income)[1:3] <- c("year","state", "median_income")

#Exporting data to a csv file to avoid problems with atomic vectors
write.csv(income, file = "MyData.csv")

#Importing the csv
income <- read_csv("mydata.csv", col_types = cols(X1 = col_skip()))


#Recoding variables
income <- income %>% mutate(state = case_when(
                                              state == "04000US01" ~ "Alabama",
                                              state == "04000US02" ~ "Alaska",
                                              state == "04000US04" ~ "Arizona",
                                              state == "04000US05" ~ "Arkansas",
                                              state == "04000US06" ~ "California",
                                              state == "04000US08" ~ "Colorado",
                                              state == "04000US09" ~ "Connecticut",
                                              state == "04000US10" ~ "Delaware",
                                              state == "04000US11" ~ "District of Columbia",
                                              state == "04000US12" ~ "Florida",
                                              state == "04000US13" ~ "Georgia",
                                              state == "04000US15" ~ "Hawaii",
                                              state == "04000US16" ~ "Idaho",
                                              state == "04000US17" ~ "Illinois",
                                              state == "04000US18" ~ "Indiana",
                                              state == "04000US19" ~ "Iowa",
                                              state == "04000US20" ~ "Kansas",
                                              state == "04000US21" ~ "Kentucky",
                                              state == "04000US22" ~ "Louisiana",
                                              state == "04000US23" ~ "Maine",
                                              state == "04000US24" ~ "Maryland",
                                              state == "04000US25" ~ "Massachusetts",
                                              state == "04000US26" ~ "Michigan",
                                              state == "04000US27" ~ "Minnesota",
                                              state == "04000US28" ~ "Mississippi",
                                              state == "04000US29" ~ "Missouri",
                                              state == "04000US30" ~ "Montana",
                                              state == "04000US31" ~ "Nebraska",
                                              state == "04000US32" ~ "Nevada",
                                              state == "04000US33" ~ "New Hampshire",
                                              state == "04000US34" ~ "New Jersey",
                                              state == "04000US35" ~ "New Mexico",
                                              state == "04000US36" ~ "New York",
                                              state == "04000US37" ~ "North Carolina",
                                              state == "04000US38" ~ "North Dakota",
                                              state == "04000US39" ~ "North Ohio",
                                              state == "04000US40" ~ "Oklahoma", 
                                              state == "04000US41" ~ "Oregon", 
                                              state == "04000US42" ~ "Pennsylvania",
                                              state == "04000US44" ~ "Rhode Island",
                                              state == "04000US45" ~ "South Carolina",
                                              state == "04000US46" ~ "South Dakota",
                                              state == "04000US47" ~ "Tennessee",
                                              state == "04000US48" ~ "Texas",
                                              state == "04000US49" ~ "Utah",
                                              state == "04000US50" ~ "Vermont",
                                              state == "04000US51" ~ "Virginia",
                                              state == "04000US53" ~ "Washington",
                                              state == "04000US54" ~ "West Virginia",
                                              state == "04000US55" ~ "Wisconsin",
                                              state == "04000US56" ~ "Wyoming",
                                              state == "04000US72" ~ "Puerto Rico"))
```



```{r}
#unique(drug_set$Indicator)


```



<!--Jumbotron -->



<div class="jumbotron jumbotron-fluid" id="background_div">
<h1 class = "text-center" >Drug related deaths in Conneticut</h1>




<!-- Introduction text -->
<div class = "container" id  = "introduction">
<hr style ="margin-bottom:10%;" />

  <h2 class = "text-center"> Introduction </h2>
  <p class = "text-center"> In this casestudy we're going to look at drug related death in Conneticut ipsoms lorums ripsbusker og andre buskvekster ipsoms lorums ripsbusker og andre buskvekster ipsoms lorums ripsbusker og andre buskvekster ipsoms lorums ripsbusker og andre buskvekster  </p> 
  
<hr style = margin-top:10% />




<!--Numbers -->
<div id="numbers">   
<div class="container-fluid" id="numbers_container">   

<div class="card">
<center>
```{r echo = FALSE, message= FALSE}
# ggplot() +
#   geom_bar(data = drugsidents, aes (Race)) +
#   labs(
#         title = "Races",
#         y = "Count") +
#     theme_dark()
```
</center>

<div class="card-body">
<p class="card-text text-center">Drug related use up by going to look at drug related death in Conneticut ipsoms lorums ripsbusker og andre buskvekster ipsoms lorums ripsbuske </p>
</div>
</div>




</div>
</div>



<!--Maps -->
<div class = "container" id  = "maps">
  <h2 class = "text-center"> Map </h2>


```{r Data_setup_maps}
# setting digits to 9 for precise latitude longitude data 
options(digits=9)

# setting what page to scrape HTML data from 
page <- read_html("https://inkplant.com/code/state-latitudes-longitudes")

# Naming the dataset and collecting the html node (data table) from our page as html text
statesmap <- page%>% html_nodes("tr td") %>% html_text()

# making it a dataframe of 1 colum and 156 observations 
statesmap <- as.data.frame(statesmap)

# dividing it to three colums spliting for three observations a time into one of the three colums 
statesmap <- as.data.frame(split(statesmap, 1:3))

# making every colum to a character colum so it is easy to work with 
statesmap$statesmap <- as.character(statesmap$statesmap)
statesmap$statesmap.1 <- as.character(statesmap$statesmap.1)
statesmap$statesmap.2 <- as.character(statesmap$statesmap.2)

# Using dplyr to convert it from 'data.frame' to ‘tbl_df’, ‘tbl’ and 'data.frame'
statesmap <- tbl_df(statesmap)

# making the first row the names of the variable then removing the row afterwards 
colnames(statesmap) <- statesmap[1,]
statesmap <- statesmap[-1, ,drop=FALSE]

# making the longitude and latitude data numeric
statesmap$Latitude <- as.numeric(statesmap$Latitude)
statesmap$Longitude <- as.numeric(statesmap$Longitude)

# for the leaflet function 
lat <- as.numeric(statesmap$Latitude)
long <- as.numeric(statesmap$Longitude)
namestate <- statesmap$State

# dataset is finished 
knitr::kable(head(statesmap))

```


<center>
```{r map, echo = FALSE, message= FALSE, fig.width=8}

# basic map
m <- leaflet() %>%
  addTiles() %>%  
  addMarkers(lng=c(long), lat=c(lat), 
             popup = c(namestate))
m

# browseURL("https://wiki.earthdata.nasa.gov/display/GIBS/GIBS+API+for+Developers#GIBSAPIforDevelopers-TimeDimension")

# trying some other apperances 
m %>% addProviderTiles("MtbMap")
m %>% addProviderTiles("HikeBike.HikeBike")

# I can like this 
m %>% addProviderTiles("NASAGIBS.ViirsEarthAtNight2012")

# With opacity 0.5
leaflet() %>%
    addTiles() %>%  
    addMarkers(lng=c(long), lat=c(lat), 
             popup = c(namestate)) %>% 
    addProviderTiles("NASAGIBS.ModisTerraTrueColorCR",
                        options = providerTileOptions(time = "2015-08-30", opacity = 0.5))

# With opacity 1. now a satelitte image 
leaflet() %>%
    addTiles() %>%  
    addMarkers(lng=c(long), lat=c(lat), 
             popup = c(namestate)) %>% 
    addProviderTiles("NASAGIBS.ModisTerraTrueColorCR",
                        options = providerTileOptions(time = "2015-08-30", opacity = 1))

# 1. december this year  
leaflet() %>%
    addTiles() %>%  
    addMarkers(lng=c(long), lat=c(lat), 
             popup = c(namestate)) %>% 
    addProviderTiles("NASAGIBS.ModisTerraTrueColorCR",
                        options = providerTileOptions(time = "2018-12-01", opacity = 0.7))

```
</center>



```{r}


library(housingData)
df1 <- geoCounty

alabama <- filter(df1, rMapState=="alabama")
mean(alabama$lon)
mean(alabama$lat)



m <- leaflet() %>%
  addTiles() %>%  # Add default OpenStreetMap map tiles
  addMarkers(lng=mean(alabama$lon), lat=mean(alabama$lat), popup="The birthplace of R")
m
```



<!--Statistics -->


<div id ="stat">
<h2 class = "text-center"> Statistics </h2>

<div class="container-fluid" id="stat_container">   

<div class="col-md-6" id = "graph1">
```{r graph, echo = FALSE, message= FALSE}
# ggplot() +
#   geom_bar(data = drugsidents, aes (Race)) +
#   labs(
#         title = "Races",
#         y = "Count") 

```
</div>


<div class="col-md-6" id = "textgraph">
<p> ipsoms lorums ripsbusker og andre buskvekster ipsoms lorums ripsbusker og andre buskvekster ipsoms lorums ripsbusker og andre buskvekster </p>
</div>


</div>
</div>









</div>


  






