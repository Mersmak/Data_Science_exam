---
title: ''
output:
  html_document:
    css:
    - style.css
    - https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css
  pdf_document: default
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r Data_import_main, echo = FALSE, message = FALSE, warning= FALSE}
rm(list = ls())
library(tidyverse)
library(leaflet)
library(dplyr)
library(readr)
library(jsonlite)
library(rvest)
library(magrittr)
library(rvest)
library(htmltab)

# Data on Drug accidents in the US 2015-2018
drug_set <- read_csv("https://data.cdc.gov/api/views/xkb8-kh2a/rows.csv?accessType=DOWNLOAD")

# Adding states names to dataset

drug_set <- drug_set %>% mutate(state = case_when(State == "AK" ~ "Alaska",
                                                  State == "AL" ~ "Alabama",
                                                  State == "AZ" ~ "Arizona",
                                                  State == "AR" ~ "Arkansas",
                                                  State == "CA" ~ "California",
                                                  State == "CO" ~ "Colorado",
                                                  State == "CT" ~ "Connecticut",
                                                  State == "DC" ~ "District of Columbia",
                                                  State == "DE" ~ "Delaware",
                                                  State == "FL" ~ "Florida",
                                                  State == "GA" ~ "Georgia",
                                                  State == "HI" ~ "Hawaii",
                                                  State == "ID" ~ "Idaho",
                                                  State == "IL" ~ "Illinois",
                                                  State == "IN" ~ "Indiana",
                                                  State == "IA" ~ "Iowa",
                                                  State == "KS" ~ "Kansas",
                                                  State == "KY" ~ "Kentucky",
                                                  State == "LA" ~ "Louisiana",
                                                  State == "ME" ~ "Maine",
                                                  State == "MD" ~ "Maryland",
                                                  State == "MA" ~ "Massachusetts",
                                                  State == "MI" ~ "Michigan",
                                                  State == "MN" ~ "Minnesota",
                                                  State == "MS" ~ "Mississippi",
                                                  State == "MO" ~ "Missouri",
                                                  State == "MT" ~ "Montana",
                                                  State == "NE" ~ "Nebraska",
                                                  State == "NV" ~ "Nevada",
                                                  State == "NH" ~ "New Hampshire",
                                                  State == "NJ" ~ "New Jersey",
                                                  State == "NM" ~ "New Mexico",
                                                  State == "NY" ~ "New York",
                                                  State == "NC" ~ "North Carolina",
                                                  State == "ND" ~ "North Dakota",
                                                  State == "OH" ~ "Ohio",
                                                  State == "OK" ~ "Oklahoma",
                                                  State == "OR" ~ "Oregon",
                                                  State == "PA" ~ "Pennsylvania",
                                                  State == "RI" ~ "Rhode Island",
                                                  State == "SC" ~ "South Carolina",
                                                  State == "SD" ~ "South Dakota",
                                                  State == "TN" ~ "Tennessee",
                                                  State == "TX" ~ "Texas",
                                                  State == "US" ~ "United States of America federal state",
                                                  State == "UT" ~ "Utah",
                                                  State == "VT" ~ "Vermont",
                                                  State == "VA" ~ "Virginia", 
                                                  State == "WA" ~ "Washington",
                                                  State == "WV" ~ "West Virginia",
                                                  State == "WI" ~ "Wisconsin",
                                                  State == "WY" ~ "Wyoming",
                                                  State == "YC" ~ "Yucatan(MEX)"))
# Changing colnames 
colnames(drug_set) <- c("State","State_abbreviations","Year", "Month", "Indicator", "Deaths", "Predicted_Value", "Percent_complete", "Percent_pending_investigation","Footnote","State_name")

# Removing the first colum we have two of                                                                       
drug_set$State <- NULL

# Rearranging colums 
drug_set <- drug_set[,c(10,1,2,3,4,5,6,7,8,9)]


# Taking a look at the dataset after cleaning. 
knitr::kable(head(drug_set))

# Examining the footnote colum
unique(drug_set$Footnote)
unique(drug_set$Year)

# If the code below is runned the data for 2017 and 2018 are removed. This is because the investigation on cases not are 
# juridicaly finished and solved and some cases are underreported due to incomplete data. We still want to use the data for 2017 and 2018.

# drug_set <- drug_set %>%
  # filter(is.na(Footnote))





##################################

```


```{r Data_import_population}

############################
# We need population data for all the years so we can compare the different states by how many people actualy living in them.
# Without this comparison it would mean nothing that there is more deaths in California than in Wyoming since it lives 
# a lot more people in california compared to Wyoming. 


# population pr state 2015
# we are using the rvest package to scrape the following website with the data for 2015.
page <- read_html("https://www.infoplease.com/us/states/state-population-rank-2015")

# the table are in the node "tr td"
pop2015 <- page%>% html_nodes("tr td") %>% html_text()

# making the node as a one colum dataframe for easier manipulation 
pop2015 <- as.data.frame(pop2015)

# splitting the dataframe into two colums 
pop2015 <- as.data.frame(split(pop2015, 1:2))

# using dplyr to make it a tibble 
pop2015 <- tbl_df(pop2015)

# changing the names of the colums 
names(pop2015)[1] <- "State"
names(pop2015)[2] <- "Population2015"

# Making everything as characters so we can use the function below
pop2015$State <- as.character(pop2015$State)
pop2015$Population2015 <- as.character(pop2015$Population2015)

# taking the "," out of the tibble so we make the population data numeric 
pop2015[] <- lapply(pop2015, function(x) as.character(gsub("[,]", "", x)))

# making the data numeric 
pop2015$Population2015 <- as.numeric(pop2015$Population2015)

# arranging the states alfabeticaly 
pop2015 <- pop2015[order(pop2015$State),]

# removing row 45 containing the sum of all the states 
pop2015 <- pop2015[-45,]

# changing dc to District of Columbia so it will correspond with the other data 
pop2015[8,1] <- "District of Columbia"

# The scrape for 2015 is finished. 


############################

# population pr state 2016 
# For 2016 we are also using the rvest package to scrape the following website with the data for 2016.
page <- read_html("https://dilemma-x.net/2016/12/21/u-s-state-populations-2016-most-populous-states/")

# the table are in the node "tr td"
pop2016 <- page%>% html_nodes("tr td") %>% html_text()

# same prosidure as for 2015
pop2016 <- as.data.frame(pop2016)
pop2016 <- tbl_df(pop2016)

# removing all the data for the rows not containing the table we want, could to this just collecting the rows as well.
pop2016 <- pop2016[-c(1:364),]
pop2016 <- pop2016[-c(172:213),]

# same prosidure as for 2015
pop2016 <- as.data.frame(split(pop2016, 1:3))
pop2016 <- tbl_df(pop2016)

# removing a colum for 2010 data 
pop2016$pop2016.1 <- NULL

# renaming colums 
names(pop2016)[1] <- "State"
names(pop2016)[2] <- "Population2016"

# removing summary rows of data
pop2016 <- pop2016[-c(1:6),]

# making everything as characters so we can use the function below 
pop2016$State <- as.character(pop2016$State)
pop2016$Population2016 <- as.character(pop2016$Population2016)

# removing "," from the data so could make numeric 
pop2016[] <- lapply(pop2016, function(x) as.character(gsub("[,]", "", x)))

# making numeric
pop2016$Population2016 <- as.numeric(pop2016$Population2016)

# arranging the states alfabeticaly 
pop2016 <- pop2016[order(pop2016$State),]

# Populationdata for 2016 is ready 

############################

# Population pr state 2017 
# This is a wikipedia table so it is really nice to scrape using the htmlTab package 
pop2017 <- htmltab("https://en.wikipedia.org/wiki/List_of_states_and_territories_of_the_United_States_by_population",3)

# already a table, so just removing the colums we dont need 
pop2017 <- pop2017[,c(1,3)]

# making it a tibble 
pop2017 <- tbl_df(pop2017)

# removing the rows containing summarys and other variables not relevant 
pop2017 <- pop2017[-c(7,13,14,22,27,32,33,39,47,48,57,63,64,65,66,67,68,69,70,71),]

# we now have 51 states, and renaming the colums 
names(pop2017)[1] <- "State"
names(pop2017)[2] <- "Population2017"

# Just doing the same as for the previous years 
pop2017$State <- as.character(pop2017$State)
pop2017$Population2017 <- as.character(pop2017$Population2017)
pop2017[] <- lapply(pop2017, function(x) as.character(gsub("[,]", "", x)))
pop2017$Population2017 <- as.numeric(pop2017$Population2017)
pop2017 <- pop2017[order(pop2017$State),]

# 2017 is now ready for take off.

############################

# for 2018 we are back with the rvest package and "tr td" so this should be a quick one.
page <- read_html("http://worldpopulationreview.com/states/")
pop2018 <- page%>% html_nodes("tr td") %>% html_text()
pop2018 <- as.data.frame(pop2018)
pop2018 <- as.data.frame(split(pop2018, 1:5))
pop2018 <- tbl_df(pop2018)
pop2018 <- pop2018[,c(2,3)]
names(pop2018)[1] <- "State"
names(pop2018)[2] <- "Population2018"
pop2018 <- pop2018[-1,]
pop2018$State <- as.character(pop2018$State)
pop2018$Population2018 <- as.character(pop2018$Population2018)
pop2018[] <- lapply(pop2018, function(x) as.character(gsub("[,]", "", x)))
pop2018$Population2018 <- as.numeric(pop2018$Population2018)
pop2018 <- pop2018[order(pop2018$State),]

# Boom, 2018 is go, then we just merge all the datasets togheter with the merge function.
PopulationUS <- Reduce(function(x, y) merge(x, y, all=TRUE), list(pop2015,pop2016,pop2017,pop2018))
# This is actually so cool hehe. 
```


```{r Data_import_unemployment}
# it is also interesting to see if we can see some correlation with drug overdoses and unemployment rates for the different states, so we should scrape some data on that as well. BTW, we are using the CSS selector gadget plugin for Google chrome to
# see what nodes we should collect from the different webpages. 

# for 2015 
page <- read_html("https://www.bls.gov/lau/lastrk15.htm")
states2015 <- page%>% html_nodes("tr th") %>% html_text()
states2015 <- as.data.frame(states2015)
states2015 <- tbl_df(states2015)
states2015 <- states2015[c(5:55),]
names(states2015)[1] <- "State"
states2015$State <- as.character(states2015$State)


figures2015 <- page%>% html_nodes("td span") %>% html_text()
figures2015 <- as.data.frame(figures2015)
figures2015 <- tbl_df(figures2015)

figures2015 <- figures2015[c(4:105),]
figures2015 <- as.data.frame(split(figures2015, 1:2))
figures2015 <- tbl_df(figures2015)
names(figures2015)[1] <- "Rate2015"
names(figures2015)[2] <- "Rank2015"
figures2015$Rate2015 <- as.character(figures2015$Rate2015)
figures2015$Rank2015 <- as.character(figures2015$Rank2015)
figures2015$Rate2015 <- as.numeric(figures2015$Rate2015)
figures2015$Rank2015 <- as.numeric(figures2015$Rank2015)

unploy2015 <- cbind(states2015,figures2015) 
unploy2015 <- unploy2015[order(unploy2015$State),]


# Same structure on data for the other years so just doing the same but changing the numbers to 201x
# for 2016
page <- read_html("https://www.bls.gov/lau/lastrk16.htm")
states2016 <- page%>% html_nodes("tr th") %>% html_text()
states2016 <- as.data.frame(states2016)
states2016 <- tbl_df(states2016)
states2016 <- states2016[c(5:55),]
names(states2016)[1] <- "State"
states2016$State <- as.character(states2016$State)

figures2016 <- page%>% html_nodes("td span") %>% html_text()
figures2016 <- as.data.frame(figures2016)
figures2016 <- tbl_df(figures2016)

figures2016 <- figures2016[c(4:105),]
figures2016 <- as.data.frame(split(figures2016, 1:2))
figures2016 <- tbl_df(figures2016)
names(figures2016)[1] <- "Rate2016"
names(figures2016)[2] <- "Rank2016"
figures2016$Rate2016 <- as.character(figures2016$Rate2016)
figures2016$Rank2016 <- as.character(figures2016$Rank2016)
figures2016$Rate2016 <- as.numeric(figures2016$Rate2016)
figures2016$Rank2016 <- as.numeric(figures2016$Rank2016)

unploy2016 <- cbind(states2016,figures2016) 
unploy2016 <- unploy2016[order(unploy2016$State),]

# for 2017
page <- read_html("https://www.bls.gov/lau/lastrk17.htm")
states2017 <- page%>% html_nodes("tr th") %>% html_text()
states2017 <- as.data.frame(states2017)
states2017 <- tbl_df(states2017)
states2017 <- states2017[c(5:55),]
names(states2017)[1] <- "State"
states2017$State <- as.character(states2017$State)


figures2017 <- page%>% html_nodes("td span") %>% html_text()
figures2017 <- as.data.frame(figures2017)
figures2017 <- tbl_df(figures2017)

figures2017 <- figures2017[c(4:105),]
figures2017 <- as.data.frame(split(figures2017, 1:2))
figures2017 <- tbl_df(figures2017)
names(figures2017)[1] <- "Rate2017"
names(figures2017)[2] <- "Rank2017"
figures2017$Rate2017 <- as.character(figures2017$Rate2017)
figures2017$Rank2017 <- as.character(figures2017$Rank2017)
figures2017$Rate2017 <- as.numeric(figures2017$Rate2017)
figures2017$Rank2017 <- as.numeric(figures2017$Rank2017)

unploy2017 <- cbind(states2017,figures2017) 
unploy2017 <- unploy2017[order(unploy2017$State),]


# for 2018 (october)
page <- read_html("https://www.bls.gov/web/laus/laumstrk.htm")
states2018 <- page%>% html_nodes("tr th") %>% html_text()
states2018 <- as.data.frame(states2018)
states2018 <- tbl_df(states2018)
states2018 <- states2018[c(4:54),]
names(states2018)[1] <- "State"
states2018$State <- as.character(states2018$State)


figures2018 <- page%>% html_nodes("td span") %>% html_text()
figures2018 <- as.data.frame(figures2018)
figures2018 <- tbl_df(figures2018)

figures2018 <- figures2018[c(3:104),]
figures2018 <- as.data.frame(split(figures2018, 1:2))
figures2018 <- tbl_df(figures2018)
names(figures2018)[1] <- "Rate2018"
names(figures2018)[2] <- "Rank2018"
figures2018$Rate2018 <- as.character(figures2018$Rate2018)
figures2018$Rank2018 <- as.character(figures2018$Rank2018)
figures2018$Rate2018 <- as.numeric(figures2018$Rate2018)
figures2018$Rank2018 <- as.numeric(figures2018$Rank2018)

unploy2018 <- cbind(states2018,figures2018) 
unploy2018 <- unploy2018[order(unploy2018$State),]

# combining all the data in to one data set 
unployUS <- cbind(unploy2015,unploy2016,unploy2017,unploy2018)
unployUS <- unployUS[,-c(4,7,10)]

# we are up and running 


# combining the two datasets
comparedata <- cbind(PopulationUS,unployUS)
comparedata <- comparedata[,-6]

```


```{r Data_import_weather}

# weather data 
# sunshine 

page <- read_html("https://www.currentresults.com/Weather/US/average-annual-state-sunshine.php")

sun <- page%>% html_nodes("tr td") %>% html_text()

sun <- as.data.frame(sun)

sun <- as.data.frame(split(sun, 1:5))

sun <- tbl_df(sun)

sun <- sun[,c(1,5)]

names(sun)[1] <- "State"
names(sun)[2] <- "Clear_days"

sun$State <- as.character(sun$State)
sun$Clear_days <- as.character(sun$Clear_days)
sun$Clear_days <- as.numeric(sun$Clear_days)

sun <- sun[order(sun$State),]

# finished 



# temperature 
page <- read_html("https://www.currentresults.com/Weather/US/average-annual-state-temperatures.php")

temp <- page%>% html_nodes("tr td") %>% html_text()

temp <- as.data.frame(temp)

temp <- as.data.frame(split(temp, 1:4))

temp <- tbl_df(temp)

temp <- temp[,c(1,3)]

names(temp)[1] <- "State"
names(temp)[2] <- "TempC"

temp$State <- as.character(temp$State)
temp$TempC <- as.character(temp$TempC)
temp$TempC <- as.numeric(temp$TempC)

temp <- temp[order(temp$State),]

# finished 

page <- read_html("https://www.currentresults.com/Weather/US/average-annual-state-precipitation.php")

prec <- page%>% html_nodes("tr td") %>% html_text()

prec <- as.data.frame(prec)

prec <- as.data.frame(split(prec, 1:4))

prec <- tbl_df(prec)

prec <- prec[,c(1,3)]

names(prec)[1] <- "State"
names(prec)[2] <- "PrecipitationMM"

prec$State <- as.character(prec$State)
prec$PrecipitationMM <- as.character(prec$PrecipitationMM)
prec$PrecipitationMM <- as.numeric(prec$PrecipitationMM)

prec <- prec[order(prec$State),]

# finished 

weather <- cbind(sun,temp,prec)
weather <- weather[,c(1,2,4,6)]
# DC missing so must NA manually 
DC <-  data.frame(State = "District of Columbia", Clear_days = NA, TempC = NA, PrecipitationMM = NA)
weather = rbind(weather,DC)
weather <- weather[order(weather$State),]
# weather data is finished 

#########################
# Adding it to "comparedata"

comparedata <- cbind(comparedata,weather)
comparedata <- comparedata[,-14]

  
```


```{r Data_import_income}
# Data on medianincome from api
getdata <- fromJSON("https://api.datausa.io/api/?sort=desc&show=geo&required=income&sumlevel=state&year=all&where=geo%3A%5E04000US")

#Getting data out of list
income <- getdata[["data"]]

#Labeling data 
colnames(income)[1:3] <- c("year","state", "median_income")

#Exporting data to a csv file to avoid problems with atomic vectors
write.csv(income, file = "MyData.csv")

#Importing the csv
income <- read_csv("mydata.csv", col_types = cols(X1 = col_skip()))


#Recoding variables
income <- income %>% mutate(state = case_when(
                                              state == "04000US01" ~ "Alabama",
                                              state == "04000US02" ~ "Alaska",
                                              state == "04000US04" ~ "Arizona",
                                              state == "04000US05" ~ "Arkansas",
                                              state == "04000US06" ~ "California",
                                              state == "04000US08" ~ "Colorado",
                                              state == "04000US09" ~ "Connecticut",
                                              state == "04000US10" ~ "Delaware",
                                              state == "04000US11" ~ "District of Columbia",
                                              state == "04000US12" ~ "Florida",
                                              state == "04000US13" ~ "Georgia",
                                              state == "04000US15" ~ "Hawaii",
                                              state == "04000US16" ~ "Idaho",
                                              state == "04000US17" ~ "Illinois",
                                              state == "04000US18" ~ "Indiana",
                                              state == "04000US19" ~ "Iowa",
                                              state == "04000US20" ~ "Kansas",
                                              state == "04000US21" ~ "Kentucky",
                                              state == "04000US22" ~ "Louisiana",
                                              state == "04000US23" ~ "Maine",
                                              state == "04000US24" ~ "Maryland",
                                              state == "04000US25" ~ "Massachusetts",
                                              state == "04000US26" ~ "Michigan",
                                              state == "04000US27" ~ "Minnesota",
                                              state == "04000US28" ~ "Mississippi",
                                              state == "04000US29" ~ "Missouri",
                                              state == "04000US30" ~ "Montana",
                                              state == "04000US31" ~ "Nebraska",
                                              state == "04000US32" ~ "Nevada",
                                              state == "04000US33" ~ "New Hampshire",
                                              state == "04000US34" ~ "New Jersey",
                                              state == "04000US35" ~ "New Mexico",
                                              state == "04000US36" ~ "New York",
                                              state == "04000US37" ~ "North Carolina",
                                              state == "04000US38" ~ "North Dakota",
                                              state == "04000US39" ~ "North Ohio",
                                              state == "04000US40" ~ "Oklahoma", 
                                              state == "04000US41" ~ "Oregon", 
                                              state == "04000US42" ~ "Pennsylvania",
                                              state == "04000US44" ~ "Rhode Island",
                                              state == "04000US45" ~ "South Carolina",
                                              state == "04000US46" ~ "South Dakota",
                                              state == "04000US47" ~ "Tennessee",
                                              state == "04000US48" ~ "Texas",
                                              state == "04000US49" ~ "Utah",
                                              state == "04000US50" ~ "Vermont",
                                              state == "04000US51" ~ "Virginia",
                                              state == "04000US53" ~ "Washington",
                                              state == "04000US54" ~ "West Virginia",
                                              state == "04000US55" ~ "Wisconsin",
                                              state == "04000US56" ~ "Wyoming",
                                              state == "04000US72" ~ "Puerto Rico"))

  
income2015 <-  income %>% filter(year == 2015)
income2015 <- income2015[,c(2,3)]
income2015 <- income2015[-40,]
names(income2015)[1]  <- "State"
names(income2015)[2]  <- "Median_income15"
income2015 <- income2015[order(income2015$State),]



income2016 <-  income %>% filter(year == 2016)
income2016 <- income2016[,c(2,3)]
income2016 <- income2016[-52,]
names(income2016)[1]  <- "State"
names(income2016)[2]  <- "Median_income16"
income2016 <- income2016[order(income2016$State),]


incomeUS <- cbind(income2015,income2016)
incomeUS <- incomeUS[,c(1,2,4)]
```


```{r Data_import_maps}
# setting digits to 9 for precise latitude longitude data 
options(digits=9)

# setting what page to scrape HTML data from 
page <- read_html("https://inkplant.com/code/state-latitudes-longitudes")

# Naming the dataset and collecting the html node (data table) from our page as html text
statesmap <- page%>% html_nodes("tr td") %>% html_text()

# making it a dataframe of 1 colum and 156 observations 
statesmap <- as.data.frame(statesmap)

# dividing it to three colums spliting for three observations a time into one of the three colums 
statesmap <- as.data.frame(split(statesmap, 1:3))

# making every colum to a character colum so it is easy to work with 
statesmap$statesmap <- as.character(statesmap$statesmap)
statesmap$statesmap.1 <- as.character(statesmap$statesmap.1)
statesmap$statesmap.2 <- as.character(statesmap$statesmap.2)

# Using dplyr to convert it from 'data.frame' to ???tbl_df???, ???tbl??? and 'data.frame'
statesmap <- tbl_df(statesmap)

# making the first row the names of the variable then removing the row afterwards 
colnames(statesmap) <- statesmap[1,]
statesmap <- statesmap[-1, ,drop=FALSE]

# making the longitude and latitude data numeric
statesmap$Latitude <- as.numeric(statesmap$Latitude)
statesmap$Longitude <- as.numeric(statesmap$Longitude)

# ordering alfabetically just in case
statesmap <- statesmap[order(statesmap$State),]

```


```{r Compare_data_set}
# Last cbind to make the compare date complete 
comparedata <- cbind(comparedata, incomeUS, statesmap)
comparedata <- comparedata[,-c(17,20)]

```


```{r Monthly}

#Monthly average deaths for every year and drug in the dataset

#All type of drug deaths in 2015
NODOD_2015 <-  drug_set %>% filter(Indicator =='Number of Drug Overdose Deaths') %>% filter(Year =='2015')
#All type of drug deaths in 2016
NODOD_2016 <-  drug_set %>% filter(Indicator =='Number of Drug Overdose Deaths') %>% filter(Year =='2016')
#All type of drug deaths in 2017
NODOD_2017 <-  drug_set %>% filter(Indicator =='Number of Drug Overdose Deaths') %>% filter(Year =='2017')
#All type of drug deaths in 2018
NODOD_2018 <-  drug_set %>% filter(Indicator =='Number of Drug Overdose Deaths') %>% filter(Year =='2018')



#Average deaths related to all drugs by month for 2015
avg_monthly_2015 <- aggregate(Deaths ~ Month, NODOD_2015, mean) 
#Average deaths related to all drugs by month for 2016
avg_monthly_2016 <- aggregate(Deaths ~ Month, NODOD_2016, mean)
#Average deaths related to all drugs by month for 2017
avg_monthly_2017 <- aggregate(Deaths ~ Month, NODOD_2017, mean)
#Average deaths related to all drugs by month for 2018
avg_monthly_2018 <- aggregate(Deaths ~ Month, NODOD_2018, mean)

#Putting the months for 2015 in the right order
avg_monthly_2015 <- avg_monthly_2015[c(5,4,8,1,9,7,6,2,12,11,10,3),]
#Putting the months for 2016 in the right order
avg_monthly_2016 <- avg_monthly_2016[c(5,4,8,1,9,7,6,2,12,11,10,3),]
#Putting the months for 2017 in the right order
avg_monthly_2017 <- avg_monthly_2017[c(5,4,8,1,9,7,6,2,12,11,10,3),]
#Putting the months for 2018 in the right order (ONLY 4 MONTHS FOR THIS SET)
avg_monthly_2018 <- avg_monthly_2018[c(3,2,4,1),]

# ggplot() +
#    geom_line(data = felles, aes(x = quote_date, y =close.x), colour = "red" ) +   #Equinor
#     geom_line(data = felles, aes(x = quote_date, y =close.y), colour = "blue") +    #Hydro
#     xlab("Date") + ylab("Closing price") #Bytter navn p?? x og y verdien

ggplot() +
    geom_line(data = avg_monthly_2015, aes(x = Month, y =Deaths,group = 1), colour = "red" ) +   #2015
    geom_line(data = avg_monthly_2016, aes(x = Month, y =Deaths,group = 1), colour = "blue") +    #2016
  geom_line(data = avg_monthly_2017, aes(x = Month, y =Deaths,group = 1), colour = "Orange") +  #2017
    geom_line(data = avg_monthly_2018, aes(x = Month, y =Deaths,group = 1), colour = "green") +  #2018
    xlab("Month") + ylab("Deaths") 


ggplot() +
  geom_bar(stat = "identity", data = avg_monthly_2015, aes (x = Month, y = Deaths),  colour="#0000FF", fill="#0000FF") +
  #theme_classic() + 
  #scale_x_discrete(expand=c(0,0)) +
  #scale_y_continuous(expand=c(0,0)) +
  #scale_x_continuous(breaks = avg_monthly_2015$Month) +
  labs(
        title = "Deaths related to all drugs by month in 2015",
        x = "Month",
        y = "Deaths")

ggplot() +
  geom_bar(stat = "identity", data = avg_monthly_2015, aes (x = Month, y = Deaths),  colour="#0000FF", fill="#0000FF") +
  #theme_classic() + 
  #scale_x_discrete(expand=c(0,0)) +
  #scale_y_continuous(expand=c(0,0)) +
  #scale_x_continuous(breaks = avg_monthly_2015$Month) +
  labs(
        title = "Deaths related to all drugs by month in 2015",
        x = "Month",
        y = "Deaths")

ggplot() +
  geom_bar(stat = "identity", data = avg_monthly_2016, aes (x = Month, y = Deaths),  colour="#0000FF", fill="#0000FF") +
  #theme_classic() + 
  #scale_x_discrete(expand=c(0,0)) +
  #scale_y_continuous(expand=c(0,0)) +
  #scale_x_continuous(breaks = avg_monthly_2015$Month) +
  labs(
        title = "Deaths related to all drugs by month in 2015",
        x = "Month",
        y = "Deaths")

# Simple Horizontal Bar Plot with Added Labels 



# unique(drug_set$State)
# unique(drug_set$Indicator)

```


```{r Graph_median_income}

#Scatter plot for median income
ggplot(data = income, aes(x=median_income, y=state, colour = state)) +
  geom_jitter() +
  labs(
        title = "Scatter plot of median income",
        x = "Median income",
        y = "State") #Ignore error

```


```{r Death_by_drug_graph}

#Sorting out by the type of drugs
just_drugs <- drug_set %>%
  filter(
    Indicator != "Number of Deaths"  &
    Indicator != "Number of Drug Overdose Deaths"  &
    Indicator != "Percent with drugs specified"

)



ggplot(data=just_drugs, aes(x=Indicator , y= Deaths, fill = Indicator)) +
    coord_flip() +
    theme_minimal()+
    geom_bar(stat="identity") +
    labs(
        title = "Most lethal drug",
        x = "Deaths",
        y = "Drug")
```

<!--Jumbotron -->



<div class="jumbotron jumbotron-fluid" id="background_div">
<h1 class = "text-center" >Drug related deaths in Conneticut</h1>




<!-- Introduction text -->
<div class = "container" id  = "introduction">
<hr style ="margin-bottom:10%;" />

  <h2 class = "text-center"> Introduction </h2>
  <p class = "text-center"> In this casestudy we're going to look at drug related death in Conneticut ipsoms lorums ripsbusker og andre buskvekster ipsoms lorums ripsbusker og andre buskvekster ipsoms lorums ripsbusker og andre buskvekster ipsoms lorums ripsbusker og andre buskvekster  </p> 
  
<hr style = margin-top:10% />




<!--Numbers -->
<div id="numbers">   
<div class="container-fluid" id="numbers_container">   

<div class="card">
<center>
```{r echo = FALSE, message= FALSE}
# ggplot() +
#   geom_bar(data = drugsidents, aes (Race)) +
#   labs(
#         title = "Races",
#         y = "Count") +
#     theme_dark()
```
</center>

<div class="card-body">
<p class="card-text text-center">Drug related use up by going to look at drug related death in Conneticut ipsoms lorums ripsbusker og andre buskvekster ipsoms lorums ripsbuske </p>
</div>
</div>




</div>
</div>



<!--Maps -->
<div class = "container" id  = "maps">
  <h2 class = "text-center"> Map </h2>


<center>
```{r Map, echo = FALSE, message= FALSE, fig.width=8}

# for the leaflet function 
lat <- as.numeric(statesmap$Latitude)
long <- as.numeric(statesmap$Longitude)
namestate <- statesmap$State

namestate[1] <- "Alabama is the best place in the world, and it is great. there where blablabla. And alabama can suck my knob"

# dataset is finished 
knitr::kable(head(statesmap))

# basic map
m <- leaflet() %>%
  addTiles() %>%  
  addMarkers(lng=c(statesmap$Longitude), lat=c(statesmap$Latitude), 
             popup = c(namestate))
m

# browseURL("https://wiki.earthdata.nasa.gov/display/GIBS/GIBS+API+for+Developers#GIBSAPIforDevelopers-TimeDimension")

# trying some other apperances 
m %>% addProviderTiles("MtbMap")
m %>% addProviderTiles("HikeBike.HikeBike")

# I can like this 
m %>% addProviderTiles("NASAGIBS.ViirsEarthAtNight2012")

# With opacity 0.5
leaflet() %>%
    addTiles() %>%  
    addMarkers(lng=c(long), lat=c(lat), 
             popup = c(namestate)) %>% 
    addProviderTiles("NASAGIBS.ModisTerraTrueColorCR",
                        options = providerTileOptions(time = "2015-08-30", opacity = 0.5))

# With opacity 1. now a satelitte image 
leaflet() %>%
    addTiles() %>%  
    addMarkers(lng=c(long), lat=c(lat), 
             popup = c(namestate)) %>% 
    addProviderTiles("NASAGIBS.ModisTerraTrueColorCR",
                        options = providerTileOptions(time = "2015-08-30", opacity = 1))

# 1. december this year  
leaflet() %>%
    addTiles() %>%  
    addMarkers(lng=c(long), lat=c(lat), 
             popup = c(namestate)) %>% 
    addProviderTiles("NASAGIBS.ModisTerraTrueColorCR",
                        options = providerTileOptions(time = "2018-12-01", opacity = 0.7))

```
</center>





<!--Statistics -->


<div id ="stat">
<h2 class = "text-center"> Statistics </h2>

<div class="container-fluid" id="stat_container">   

<div class="col-md-6" id = "graph1">
```{r graph, echo = FALSE, message= FALSE}
# ggplot() +
#   geom_bar(data = drugsidents, aes (Race)) +
#   labs(
#         title = "Races",
#         y = "Count") 

```
</div>


<div class="col-md-6" id = "textgraph">
<p> ipsoms lorums ripsbusker og andre buskvekster ipsoms lorums ripsbusker og andre buskvekster ipsoms lorums ripsbusker og andre buskvekster </p>
</div>


</div>
</div>









</div>


  






